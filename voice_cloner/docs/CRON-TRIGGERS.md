# 定时触发器配置

## cleanup 云函数定时任务

cleanup 云函数用于定时清理过期文件,需要配置定时触发器。

### 在云开发控制台配置

1. **打开云函数列表**
   - 云开发控制台 -> 云函数 -> 找到 cleanup 函数

2. **添加触发器**
   - 点击"触发器"标签
   - 点击"新建触发器"

3. **配置参数**
   ```
   触发器名称: daily-cleanup
   触发周期: 自定义触发周期
   Cron 表达式: 0 0 3 * * * *
   
   说明: 每天凌晨 3:00 执行
   ```

### Cron 表达式说明

格式: `秒 分 时 日 月 周 年`

示例:
- `0 0 3 * * * *` - 每天凌晨 3:00
- `0 0 */6 * * * *` - 每 6 小时执行一次
- `0 0 2 * * 0 *` - 每周日凌晨 2:00

### 其他触发器配置建议

#### 1. 数据库备份 (每天凌晨2点)
```
函数: db-backup
Cron: 0 0 2 * * * *
```

#### 2. 配额重置检查 (每小时)
```
函数: quota-reset
Cron: 0 0 * * * * *
```

#### 3. 统计报表生成 (每天早上8点)
```
函数: generate-report
Cron: 0 0 8 * * * *
```

### 手动触发

在开发调试阶段,可以手动触发云函数:

1. 在云开发控制台找到 cleanup 函数
2. 点击"测试"按钮
3. 输入空的 event 对象: `{}`
4. 点击"运行测试"

### 监控和日志

- 查看执行日志: 云开发控制台 -> 云函数 -> cleanup -> 日志
- 设置告警: 云开发控制台 -> 监控告警 -> 新建告警规则

### 注意事项

1. **避免高峰时段**
   - 选择用户活跃度低的时间段(凌晨)
   - 避免与其他定时任务冲突

2. **超时设置**
   - cleanup 函数可能需要较长执行时间
   - 建议设置超时时间为 60 秒

3. **并发限制**
   - 定时触发器不会并发执行
   - 如果上次执行未完成,下次触发会等待

4. **成本控制**
   - 监控云函数调用次数
   - 定时任务会计入免费配额
