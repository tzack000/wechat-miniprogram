## ADDED Requirements

### Requirement: 用户可以启动录音
系统 SHALL 提供录音控制界面,允许用户启动、暂停、停止录音。

#### Scenario: 成功启动录音
- **WHEN** 用户点击"开始录音"按钮
- **THEN** 系统开始录制音频,并显示录音中状态指示器(如波形动画)

#### Scenario: 录音权限被拒绝
- **WHEN** 用户首次使用录音功能且未授予麦克风权限
- **THEN** 系统显示权限请求对话框,并提示需要麦克风权限才能录音

#### Scenario: 录音时长超过限制
- **WHEN** 用户录音时长超过5分钟
- **THEN** 系统自动停止录音,并提示"录音时长已达上限"

### Requirement: 用户可以停止录音
系统 SHALL 允许用户在任何时候停止录音,并保存录音文件。

#### Scenario: 正常停止录音
- **WHEN** 用户在录音过程中点击"停止"按钮
- **THEN** 系统停止录音,保存音频文件,并显示录音时长

#### Scenario: 录音时长过短
- **WHEN** 用户录音时长少于30秒即停止
- **THEN** 系统显示警告"录音时长过短,建议至少录制1分钟以获得更好效果",但仍允许保存

### Requirement: 系统检测录音质量
系统 SHALL 自动检测录音质量,包括音量、噪音水平和有效语音时长。

#### Scenario: 录音质量合格
- **WHEN** 用户完成录音且音量适中、噪音低、有效语音>30秒
- **THEN** 系统显示"录音质量良好"并允许继续下一步

#### Scenario: 音量过低
- **WHEN** 录音平均音量低于阈值(如 -40dB)
- **THEN** 系统显示"录音音量过低,请靠近麦克风重新录制"

#### Scenario: 噪音过高
- **WHEN** 录音背景噪音超过阈值(信噪比 < 10dB)
- **THEN** 系统显示"检测到较多噪音,建议在安静环境重新录制"

### Requirement: 提供录音指引文本
系统 SHALL 提供标准的录音参考文本,确保录音内容覆盖足够的音素。

#### Scenario: 显示参考文本
- **WHEN** 用户进入录音页面
- **THEN** 系统显示一段参考文本(约200-300字),包含常见音素组合

#### Scenario: 用户跟读参考文本
- **WHEN** 用户按照参考文本朗读
- **THEN** 系统同步高亮当前建议朗读的句子,帮助用户保持节奏

### Requirement: 支持多次录音和重录
系统 SHALL 允许用户录制多段音频,或重新录制替换现有音频。

#### Scenario: 添加新录音
- **WHEN** 用户已有一段录音,点击"继续录制"
- **THEN** 系统开始新的录音会话,完成后将多段录音合并

#### Scenario: 重新录制
- **WHEN** 用户对当前录音不满意,点击"重新录制"
- **THEN** 系统删除当前录音,返回录音准备状态

### Requirement: 录音文件格式转换
系统 SHALL 自动将微信录音格式(aac/mp3)转换为模型所需格式(wav,16kHz,单声道)。

#### Scenario: 上传录音自动转换
- **WHEN** 用户完成录音并上传
- **THEN** 系统在云端自动将音频转换为 wav 格式(16kHz采样率,16bit,单声道)

#### Scenario: 格式转换失败
- **WHEN** 音频文件损坏或格式不支持
- **THEN** 系统返回错误提示"音频处理失败,请重新录制"
