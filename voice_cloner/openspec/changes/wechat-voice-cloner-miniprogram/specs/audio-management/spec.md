## ADDED Requirements

### Requirement: 用户可以播放生成的音频
系统 SHALL 提供音频播放器,允许用户播放、暂停、拖动进度。

#### Scenario: 成功播放音频
- **WHEN** TTS任务完成且用户点击"播放"按钮
- **THEN** 系统加载音频并开始播放,显示播放进度条和当前播放时间

#### Scenario: 暂停和恢复播放
- **WHEN** 用户在播放过程中点击"暂停"按钮
- **THEN** 系统暂停播放,再次点击从暂停位置继续播放

#### Scenario: 拖动播放进度
- **WHEN** 用户拖动进度条到任意位置
- **THEN** 系统跳转到对应时间点继续播放

#### Scenario: 音频加载失败
- **WHEN** 音频文件URL失效或网络异常
- **THEN** 系统显示错误"音频加载失败,请检查网络连接或重新生成"

### Requirement: 用户可以下载音频文件
系统 SHALL 允许用户将生成的音频保存到本地设备。

#### Scenario: 下载到本地相册
- **WHEN** 用户点击"保存"按钮
- **THEN** 系统请求存储权限,将音频文件保存到微信文件管理或系统相册,提示"保存成功"

#### Scenario: 存储权限被拒绝
- **WHEN** 用户拒绝授予存储权限
- **THEN** 系统显示提示"需要存储权限才能保存文件",并提供跳转到设置页面的选项

### Requirement: 用户可以分享音频
系统 SHALL 支持将音频分享给微信好友或朋友圈。

#### Scenario: 分享给微信好友
- **WHEN** 用户点击"分享"按钮并选择好友
- **THEN** 系统调用微信分享接口,发送音频文件和自定义消息卡片

#### Scenario: 生成分享链接
- **WHEN** 用户选择"复制链接"
- **THEN** 系统生成临时分享链接(有效期7天),复制到剪贴板

### Requirement: 管理用户的音频历史记录
系统 SHALL 保存用户生成的音频历史,方便回溯和管理。

#### Scenario: 查看音频历史
- **WHEN** 用户进入"我的音频"页面
- **THEN** 系统显示所有历史音频列表(按创建时间倒序),包含文本预览、时长、创建时间

#### Scenario: 搜索历史音频
- **WHEN** 用户在搜索框输入关键词
- **THEN** 系统过滤显示文本内容包含该关键词的音频

#### Scenario: 删除音频记录
- **WHEN** 用户长按某条音频记录并选择"删除"
- **THEN** 系统弹出确认对话框,确认后删除该音频及相关数据

### Requirement: 音频文件存储优化
系统 SHALL 自动管理音频文件的生命周期,优化存储成本。

#### Scenario: 音频文件自动过期
- **WHEN** 音频文件创建超过30天且未被标记为"收藏"
- **THEN** 系统自动删除该音频文件,仅保留元数据记录

#### Scenario: 用户收藏音频
- **WHEN** 用户标记某个音频为"收藏"
- **THEN** 系统将该音频标记为永久保存,不受自动清理策略影响

#### Scenario: 存储空间告警
- **WHEN** 用户的音频文件总大小超过配额(如100MB)
- **THEN** 系统显示提示"存储空间不足,请删除部分音频或升级套餐"

### Requirement: 支持音频预览和快速定位
系统 SHALL 提供音频波形可视化,帮助用户快速定位和预览。

#### Scenario: 显示音频波形
- **WHEN** 用户打开音频详情页
- **THEN** 系统显示音频波形图,直观展示音量变化

#### Scenario: 点击波形跳转
- **WHEN** 用户点击波形图任意位置
- **THEN** 系统跳转到对应时间点并开始播放

### Requirement: 支持音频格式转换
系统 SHALL 支持将音频导出为不同格式,适配不同使用场景。

#### Scenario: 导出为WAV格式
- **WHEN** 用户选择"导出为WAV"
- **THEN** 系统转换音频为高质量WAV格式(44.1kHz,16bit)并下载

#### Scenario: 导出为压缩格式
- **WHEN** 用户选择"导出为低码率MP3"
- **THEN** 系统转换音频为64kbps MP3,文件大小约为原来的一半
