# 统一测试数据初始化云函数

## 概述

`initAllTestData` 是一个统一的测试数据初始化云函数，整合了原来的 `initTestData` 和 `initCourseData` 两个云函数的功能，提供了更灵活和方便的测试数据管理方式。

## 功能特性

### 支持的数据模块

1. **场馆数据 (venues)**
   - 10个不同类型的场馆（篮球、羽毛球、游泳、健身等）
   - 包含场馆详细信息、设施、规则等

2. **用户数据 (users)**
   - 测试管理员和普通用户
   - 包含用户基本信息

3. **教练数据 (coaches)**
   - 5位不同专业的教练
   - 包含教练资质、专长等信息

4. **课程数据 (courses)**
   - 10个不同类型的课程
   - 包含课程详情、价格、人数限制等

5. **课程排期 (schedules)**
   - 自动为每个课程生成未来7天的排期
   - 每天3个时段（上午、下午、晚上）

6. **预约数据 (bookings)**
   - 场馆预约历史记录和待处理预约

7. **停车配置 (parking)**
   - 停车场配置信息
   - 停车记录数据

## 使用方法

### 1. 初始化所有数据（推荐）

```javascript
// 清除所有旧数据并初始化全部测试数据
{
  "action": "all",
  "clear": true
}
```

### 2. 仅初始化特定模块

```javascript
// 只初始化场馆和课程数据，不清除旧数据
{
  "action": "all",
  "clear": false,
  "modules": ["venues", "courses", "coaches"]
}
```

### 3. 单独初始化某个模块

```javascript
// 只初始化课程数据
{
  "action": "courses",
  "clear": false
}
```

## 参数说明

### action (string)
- `all`: 初始化所有模块（默认）
- `venues`: 仅初始化场馆相关数据
- `users`: 仅初始化用户数据
- `coaches`: 仅初始化教练数据
- `courses`: 仅初始化课程数据
- `parking`: 仅初始化停车相关数据

### clear (boolean)
- `true`: 在初始化前清除所有现有数据
- `false`: 不清除现有数据，直接添加（默认）

### modules (array)
- 自定义要初始化的模块列表
- 可选值：`['venues', 'users', 'coaches', 'courses', 'parking']`
- 当 `action` 为 `all` 时生效

## 返回结果示例

```json
{
  "success": true,
  "message": "测试数据初始化完成！",
  "data": {
    "cleared": true,
    "users": { "count": 3 },
    "venues": { "count": 10 },
    "bookings": { "count": 6 },
    "parkingConfig": { "initialized": true },
    "parkingRecords": { "count": 2 },
    "coaches": { "count": 5 },
    "courses": { "count": 10 },
    "schedules": { "count": 210 }
  },
  "summary": [
    "✓ 清除现有数据完成",
    "✓ 用户: 3个",
    "✓ 场馆: 10个",
    "✓ 场馆预约: 6条",
    "✓ 停车配置: 已初始化",
    "✓ 停车记录: 2条",
    "✓ 教练: 5个",
    "✓ 课程: 10个",
    "✓ 课程排期: 210个"
  ]
}
```

## 数据依赖关系

- **用户数据** 是基础，很多其他数据需要用户ID
- **教练数据** 需要在课程数据之前初始化
- **课程排期** 会自动在课程数据初始化后创建
- **预约数据** 需要场馆和用户数据
- **停车记录** 需要用户数据

## 使用场景

### 开发测试
```javascript
// 快速重置所有测试数据
{
  "action": "all",
  "clear": true
}
```

### 演示环境
```javascript
// 只初始化展示相关的数据
{
  "modules": ["venues", "coaches", "courses"],
  "clear": false
}
```

### 性能测试
```javascript
// 只初始化需要测试的模块
{
  "modules": ["courses"],
  "clear": true
}
```

## 数据详情

### 场馆类型
- 篮球场 (2个)
- 羽毛球场 (2个)
- 游泳馆
- 乒乓球室
- 健身房
- 网球场
- 瑜伽室
- 足球场（维护中）

### 教练专业
- 瑜伽导师
- 游泳教练
- 篮球教练
- 健身私教
- 舞蹈编导

### 课程类型
- 瑜伽课程 (2个)
- 游泳课程 (2个)
- 篮球课程 (2个)
- 健身课程 (2个)
- 舞蹈课程 (2个)

## 注意事项

1. **数据清除**: 使用 `clear: true` 会删除所有相关集合的数据，请谨慎使用
2. **批量操作**: 大量数据初始化可能需要较长时间，请耐心等待
3. **依赖关系**: 某些模块依赖其他模块，建议使用 `action: "all"` 确保完整性
4. **云函数超时**: 如果数据量很大，可能会超时，建议分批初始化

## 与旧版本的对比

### 旧版本（两个独立云函数）
- `initTestData`: 场馆、用户、停车数据
- `initCourseData`: 教练、课程、排期数据

### 新版本优势
- 统一管理：一个云函数管理所有测试数据
- 灵活配置：可以选择性初始化需要的模块
- 智能依赖：自动处理数据之间的依赖关系
- 清晰反馈：提供详细的初始化结果摘要

## 部署说明

1. 在微信开发者工具中打开项目
2. 右键点击 `cloudfunctions/initAllTestData` 目录
3. 选择"上传并部署：云端安装依赖"
4. 等待部署完成
5. 在云开发控制台测试调用

## 调试建议

在微信开发者工具的云开发控制台中：

1. 先测试清除功能：`{ "clear": true, "modules": [] }`
2. 再测试单个模块：`{ "action": "users" }`
3. 最后测试完整初始化：`{ "action": "all", "clear": true }`

## 维护建议

- 定期更新测试数据以反映实际业务场景
- 根据需要调整数据量和复杂度
- 保持数据的多样性以覆盖更多测试场景
