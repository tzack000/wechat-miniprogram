# 微信开发者工具测试指南

**版本**: v1.0  
**更新日期**: 2026-01-20  
**功能**: 课程预约（支持选择教练）

---

## 📋 目录

1. [环境准备](#1-环境准备)
2. [导入项目](#2-导入项目)
3. [配置云开发](#3-配置云开发)
4. [初始化数据](#4-初始化数据)
5. [功能测试](#5-功能测试)
6. [常见问题](#6-常见问题)

---

## 1️⃣ 环境准备

### 1.1 下载微信开发者工具

**下载地址**: https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html

**推荐版本**: 最新稳定版

**操作系统**: Windows / macOS / Linux

### 1.2 注册小程序账号

1. 访问 https://mp.weixin.qq.com/
2. 注册小程序账号（建议使用测试号）
3. 记录 AppID

### 1.3 开通云开发

1. 登录小程序后台
2. 进入"云开发"菜单
3. 点击"开通云开发"
4. 创建云环境（建议名称：`test-env`）
5. 记录云环境 ID

---

## 2️⃣ 导入项目

### 2.1 克隆代码仓库

```bash
git clone git@github.com:tzack000/wechat-venue-parking-miniprogram.git
cd wechat-venue-parking-miniprogram
```

### 2.2 打开项目

1. 启动微信开发者工具
2. 选择"导入项目"
3. 选择项目目录（包含 `miniprogram` 的根目录）
4. 填写项目名称
5. 输入你的 AppID
6. 勾选"不使用云服务"（稍后再配置）
7. 点击"导入"

### 2.3 配置项目信息

在 `project.config.json` 中确认以下配置：

```json
{
  "appid": "你的AppID",
  "projectname": "场馆预约小程序",
  "cloudfunctionRoot": "cloudfunctions/",
  "miniprogramRoot": "miniprogram/",
  ...
}
```

---

## 3️⃣ 配置云开发

### 3.1 初始化云环境

1. 在微信开发者工具中，点击工具栏的"云开发"按钮
2. 选择你创建的云环境
3. 等待环境初始化完成

### 3.2 上传云函数

**上传以下云函数**：

```bash
# 必需的云函数列表
cloudfunctions/
├── coach/          # 教练管理
├── course/         # 课程管理
├── initCourseData/ # 数据初始化（可选）
├── venue/          # 场馆管理（已有）
├── booking/        # 场馆预约（已有）
└── parking/        # 停车管理（已有）
```

**上传步骤**：
1. 在左侧文件树中展开 `cloudfunctions` 目录
2. 右键点击 `coach` 文件夹
3. 选择"上传并部署：云端安装依赖"
4. 等待上传完成
5. 重复上述步骤上传 `course` 和其他云函数

**验证上传**：
1. 点击工具栏"云开发"按钮
2. 进入"云函数"标签
3. 确认看到 `coach` 和 `course` 云函数

### 3.3 创建数据库集合

在"云开发控制台" → "数据库"中创建以下集合：

| 集合名 | 说明 | 权限 |
|--------|------|------|
| `coaches` | 教练信息 | 所有用户可读，仅管理员可写 |
| `courses` | 课程信息 | 所有用户可读，仅管理员可写 |
| `course_schedules` | 课程排期 | 所有用户可读，仅管理员可写 |
| `course_bookings` | 课程预约记录 | 仅创建者可读写 |
| `users` | 用户信息（已有） | 仅创建者可读写 |

**创建步骤**：
1. 点击"添加集合"
2. 输入集合名称
3. 点击"确定"

**设置权限**（重要）：
1. 点击集合名称进入详情
2. 点击"权限设置"
3. 选择合适的权限模板
4. 保存

---

## 4️⃣ 初始化数据

### 方式一：使用云函数初始化（推荐）

1. **确认 `initCourseData` 云函数已上传**

2. **在云开发控制台调用云函数**：
   - 进入"云开发控制台" → "云函数"
   - 找到 `initCourseData` 函数
   - 点击"测试"
   - 保持默认参数 `{}`
   - 点击"测试"按钮
   - 查看返回结果确认成功

3. **验证数据**：
   - 进入"数据库"
   - 查看 `coaches` 集合：应有 5 条教练记录
   - 查看 `courses` 集合：应有 10 条课程记录

### 方式二：手动导入数据

1. **导出测试数据**：
   ```bash
   # 教练数据
   database/test_data/coaches.json
   
   # 课程数据
   database/test_data/courses.json
   ```

2. **在云开发控制台导入**：
   - 进入"数据库" → 选择集合（如 `coaches`）
   - 点击"导入"
   - 选择 JSON 文件格式
   - 上传 `coaches.json`
   - 点击"确定"
   - 重复步骤导入 `courses.json` 到 `courses` 集合

3. **注意事项**：
   - 课程数据中的 `coachIds` 字段需要替换为实际的教练 `_id`
   - 或者等数据导入后手动编辑课程记录，关联正确的教练ID

---

## 5️⃣ 功能测试

### 5.1 基础功能测试

#### 测试环境检查

1. 在开发者工具中点击"编译"
2. 确认小程序正常加载
3. 在控制台查看是否有错误信息

#### 首页入口测试

1. **启动小程序** → 应看到首页
2. **查找课程入口** → 首页应有"课程预约"按钮
3. **点击课程预约** → 跳转到课程列表页面

### 5.2 教练模块测试

#### 5.2.1 教练列表

**测试步骤**：
1. 首页 → 点击"教练"或通过课程页面进入
2. 应显示 5 位教练卡片

**验证点**：
- ✅ 显示教练头像、姓名、职称
- ✅ 显示擅长领域标签
- ✅ 显示个人简介（2行省略）
- ✅ 显示评分（如 ★ 4.9）

#### 5.2.2 教练筛选

**测试步骤**：
1. 在教练列表页
2. 点击筛选标签（如"瑜伽"）

**验证点**：
- ✅ 标签变为选中状态（蓝色背景）
- ✅ 列表只显示该领域的教练
- ✅ 点击"全部"恢复所有教练

#### 5.2.3 教练搜索

**测试步骤**：
1. 在搜索框输入"张"
2. 应只显示名字包含"张"的教练

**验证点**：
- ✅ 实时搜索生效
- ✅ 支持姓名和简介搜索
- ✅ 清空搜索恢复列表

#### 5.2.4 教练详情

**测试步骤**：
1. 点击任意教练卡片
2. 进入教练详情页

**验证点**：
- ✅ 显示完整个人信息
- ✅ 显示擅长领域列表
- ✅ 显示资质证书
- ✅ 显示授课课程列表
- ✅ 点击课程卡片跳转到课程详情

### 5.3 课程模块测试

#### 5.3.1 课程列表

**测试步骤**：
1. 首页 → 点击"课程预约"
2. 应显示 10 门课程

**验证点**：
- ✅ 显示课程图片、名称
- ✅ 显示课程类型标签
- ✅ 显示价格、时长、人数
- ✅ 显示教练头像和姓名

#### 5.3.2 课程筛选

**测试步骤**：
1. 点击类型标签（如"瑜伽"）

**验证点**：
- ✅ 标签选中状态切换
- ✅ 只显示该类型课程
- ✅ 点击"全部"显示所有课程

#### 5.3.3 课程详情

**测试步骤**：
1. 点击任意课程卡片
2. 进入课程详情页

**验证点**：
- ✅ 显示课程完整信息
- ✅ 显示可授课教练列表
- ✅ 显示课程排期（如果有）
- ✅ 显示剩余名额
- ✅ "立即预约"按钮可点击

### 5.4 课程预约测试

#### 5.4.1 选择排期和教练

**测试步骤**：
1. 在课程详情页点击"立即预约"
2. 进入预约确认页面

**验证点**：
- ✅ 显示已选课程信息
- ✅ 可选择上课时间（如果有排期）
- ✅ 可选择教练
- ✅ 显示剩余名额
- ✅ 预约信息填写表单显示

#### 5.4.2 填写预约信息

**测试步骤**：
1. 填写姓名
2. 填写联系电话

**验证点**：
- ✅ 表单验证（必填项）
- ✅ 手机号格式验证

#### 5.4.3 提交预约

**测试步骤**：
1. 填写完整信息
2. 点击"确认预约"

**预期结果**：
- ✅ 显示提交中状态
- ✅ 预约成功提示
- ✅ 自动跳转到"我的课程"
- ✅ 剩余名额减 1

**异常情况测试**：
- 名额已满时提示"名额已满"
- 重复预约时提示"已预约此课程"
- 网络异常时显示错误提示

### 5.5 用户课程管理测试

#### 5.5.1 我的课程列表

**测试步骤**：
1. 首页 → 点击"我的"
2. 点击"我的课程"

**验证点**：
- ✅ 显示所有预约记录
- ✅ 显示课程名称、时间
- ✅ 显示教练信息
- ✅ 显示预约状态
- ✅ 按预约时间倒序排列

#### 5.5.2 取消预约

**测试步骤**：
1. 在我的课程列表中
2. 点击某个预约的"取消预约"

**验证点**：
- ✅ 弹出确认对话框
- ✅ 确认后预约状态变为"已取消"
- ✅ 课程剩余名额恢复

#### 5.5.3 状态标识

**验证点**：
- ✅ 待上课：蓝色标签
- ✅ 已完成：绿色标签
- ✅ 已取消：灰色标签

### 5.6 并发预约测试（可选）

**目的**: 验证名额控制是否正确

**测试方法**：
1. 使用多个测试账号同时预约同一课程
2. 或在代码中使用测试脚本模拟并发

**验证点**：
- ✅ 最终预约人数 ≤ 课程最大人数
- ✅ 不会出现超额预约
- ✅ 名额耗尽后提示"名额已满"

**参考测试脚本**：
```bash
# 运行本地并发测试
node tests/course_booking_test.js
```

---

## 6️⃣ 常见问题

### Q1: 云函数调用失败

**现象**: 页面提示"云函数调用失败"

**可能原因**：
- 云函数未上传或部署失败
- 云环境未正确配置
- 没有云开发权限

**解决方案**：
1. 检查云函数是否上传成功
2. 在云开发控制台手动测试云函数
3. 检查云环境ID是否正确
4. 确认小程序有云开发权限

### Q2: 数据加载不出来

**现象**: 列表页面为空或显示"暂无数据"

**可能原因**：
- 数据库集合未创建
- 测试数据未导入
- 集合权限设置错误

**解决方案**：
1. 检查数据库集合是否存在
2. 检查集合中是否有数据
3. 检查集合权限：应设置为"所有用户可读"
4. 在控制台手动添加测试数据验证

### Q3: 页面报错 "xxx is not defined"

**现象**: 控制台显示变量或函数未定义

**可能原因**：
- 云函数代码有误
- 前端代码有误
- 依赖包未安装

**解决方案**：
1. 检查云函数代码
2. 云函数上传时选择"云端安装依赖"
3. 检查 `package.json` 中的依赖

### Q4: 预约提交失败

**现象**: 点击"确认预约"后失败

**可能原因**：
- 课程排期数据不存在
- 教练ID关联错误
- 用户未登录

**解决方案**：
1. 确保课程有排期数据
2. 检查课程的 `coachIds` 字段是否正确
3. 在小程序中先登录

### Q5: 图片不显示

**现象**: 教练头像或课程图片显示空白

**可能原因**：
- 测试数据中的图片URL是占位符
- 网络权限未配置

**解决方案**：
1. 将测试数据中的图片URL替换为真实图片
2. 或使用微信提供的测试图片
3. 在 `project.config.json` 中配置网络权限

### Q6: 无法创建排期

**现象**: 管理员功能未实现

**说明**: 
- 管理员UI界面暂未实现
- 可通过云开发控制台手动创建数据
- 或使用云函数API创建

**临时方案**：
在云开发控制台 → 数据库 → `course_schedules` 中手动添加记录：

```json
{
  "courseId": "课程ID",
  "coachId": "教练ID",
  "date": "2026-01-25",
  "startTime": "10:00",
  "endTime": "11:00",
  "maxStudents": 15,
  "bookedCount": 0,
  "status": "available",
  "createTime": new Date(),
  "updateTime": new Date()
}
```

---

## 7️⃣ 测试检查清单

### 准备阶段
- [ ] 已下载并安装微信开发者工具
- [ ] 已注册小程序账号并获取AppID
- [ ] 已开通云开发环境
- [ ] 已克隆代码仓库

### 配置阶段
- [ ] 已导入项目到开发者工具
- [ ] 已配置云环境ID
- [ ] 已上传所有云函数（coach、course）
- [ ] 已创建数据库集合（4个）
- [ ] 已初始化测试数据（5教练+10课程）

### 功能测试
- [ ] 首页显示正常
- [ ] 教练列表显示正常（5位）
- [ ] 教练筛选功能正常
- [ ] 教练详情显示正常
- [ ] 课程列表显示正常（10门）
- [ ] 课程筛选功能正常
- [ ] 课程详情显示正常
- [ ] 课程预约流程完整
- [ ] 我的课程显示正常
- [ ] 取消预约功能正常

### 异常测试
- [ ] 名额已满时正确提示
- [ ] 重复预约时正确提示
- [ ] 网络异常时显示友好提示
- [ ] 空数据时显示空状态

---

## 8️⃣ 测试报告模板

测试完成后，建议记录测试结果：

```markdown
## 测试报告

**测试人员**: [姓名]
**测试日期**: 2026-01-XX
**小程序版本**: v1.0
**测试环境**: 微信开发者工具

### 测试结果
- 教练模块: ✅ 通过 / ❌ 失败
- 课程模块: ✅ 通过 / ❌ 失败
- 预约功能: ✅ 通过 / ❌ 失败
- 用户功能: ✅ 通过 / ❌ 失败

### 发现的问题
1. [问题描述]
   - 复现步骤：
   - 预期结果：
   - 实际结果：

### 建议
[测试建议]
```

---

## 9️⃣ 联系支持

如遇到问题，可通过以下方式获取帮助：

1. **查看文档**:
   - `TEST_REPORT.md` - 功能测试报告
   - `openspec/changes/add-course-booking-with-coach/` - 设计文档

2. **GitHub Issues**:
   - https://github.com/tzack000/wechat-venue-parking-miniprogram/issues

3. **微信开发者社区**:
   - https://developers.weixin.qq.com/community/

---

## 🎉 完成测试

测试完成后，如果所有功能正常，您可以：
1. ✅ 继续开发管理员功能
2. ✅ 邀请真实用户测试
3. ✅ 准备发布上线

祝测试顺利！🚀
