<!--è¯¾ç¨‹è¯¦æƒ…é¡µé¢-->
<view class="container" wx:if="{{course}}">
  <!-- è¯¾ç¨‹å¤´å›¾ -->
  <swiper class="course-swiper" indicator-dots indicator-color="rgba(255,255,255,0.5)" indicator-active-color="#fff">
    <swiper-item wx:for="{{course.images}}" wx:key="*this">
      <image src="{{item}}" mode="aspectFill" class="course-image"></image>
    </swiper-item>
    <swiper-item wx:if="{{!course.images || course.images.length === 0}}">
      <image src="/images/default-course.png" mode="aspectFill" class="course-image"></image>
    </swiper-item>
  </swiper>

  <!-- è¯¾ç¨‹ä¿¡æ¯ -->
  <view class="course-info">
    <view class="info-header">
      <text class="course-name">{{course.name}}</text>
      <text class="course-type">{{course.typeName}}</text>
    </view>
    <view class="info-meta">
      <text class="meta-item">â± {{course.duration}}åˆ†é’Ÿ</text>
      <text class="meta-item">ğŸ‘¥ {{course.maxStudents}}äºº</text>
      <text class="meta-item price">Â¥{{course.price}}/æ¬¡</text>
    </view>
    <text class="course-description">{{course.description}}</text>
  </view>

  <!-- å¯æˆè¯¾æ•™ç»ƒ -->
  <view class="section">
    <view class="section-title">æˆè¯¾æ•™ç»ƒ</view>
    <scroll-view scroll-x class="coach-scroll">
      <view class="coach-list">
        <view 
          class="coach-item {{selectedCoachId === '' ? 'active' : ''}}"
          bindtap="onCoachSelect"
          data-id=""
        >
          <text>å…¨éƒ¨</text>
        </view>
        <view 
          class="coach-item {{selectedCoachId === item._id ? 'active' : ''}}"
          wx:for="{{coaches}}"
          wx:key="_id"
          bindtap="onCoachSelect"
          data-id="{{item._id}}"
        >
          <image class="coach-avatar" src="{{item.avatar}}" mode="aspectFill"></image>
          <text class="coach-name">{{item.name}}</text>
          <text class="coach-title">{{item.title}}</text>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- æ—¥æœŸé€‰æ‹© -->
  <view class="section">
    <view class="section-title">é€‰æ‹©æ—¥æœŸ</view>
    <scroll-view scroll-x class="date-scroll">
      <view class="date-list">
        <view 
          class="date-item {{selectedDate === item.date ? 'active' : ''}}"
          wx:for="{{dates}}"
          wx:key="date"
          bindtap="onDateSelect"
          data-date="{{item.date}}"
        >
          <text class="date-label">{{item.label}}</text>
          <text class="date-weekday">{{item.weekDay}}</text>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- è¯¾ç¨‹æ’æœŸ -->
  <view class="section">
    <view class="section-title">å¯é¢„çº¦æ—¶æ®µ</view>
    
    <view class="schedule-list" wx:if="{{schedules.length > 0}}">
      <view 
        class="schedule-item {{item.status === 'full' || item.availableSeats <= 0 ? 'disabled' : ''}}"
        wx:for="{{schedules}}"
        wx:key="_id"
        bindtap="onBook"
        data-schedule="{{item}}"
      >
        <view class="schedule-time">
          <text class="time">{{item.startTime}} - {{item.endTime}}</text>
          <text class="coach-name" wx:if="{{item.coachInfo}}">{{item.coachInfo.name}}</text>
        </view>
        <view class="schedule-info">
          <text class="seats" wx:if="{{item.status !== 'full' && item.availableSeats > 0}}">
            å‰©ä½™{{item.availableSeats}}ä¸ªåé¢
          </text>
          <text class="status-full" wx:if="{{item.status === 'full' || item.availableSeats <= 0}}">
            å·²æ»¡
          </text>
        </view>
        <view class="schedule-action">
          <text wx:if="{{item.status !== 'full' && item.availableSeats > 0}}">é¢„çº¦</text>
          <text wx:else class="disabled-text">å·²æ»¡</text>
        </view>
      </view>
    </view>

    <!-- åŠ è½½ä¸­ -->
    <view class="empty-status" wx:if="{{loading}}">
      <text>åŠ è½½ä¸­...</text>
    </view>

    <!-- æ— æ’æœŸ -->
    <view class="empty-status" wx:if="{{!loading && schedules.length === 0}}">
      <text>è¯¥æ—¥æœŸæš‚æ— å¯é¢„çº¦æ—¶æ®µ</text>
    </view>
  </view>
</view>
